<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>2D Fighting Game</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.play.min.js"></script>
  <style>
    body {
      margin: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: #222;
    }
    canvas {
      border: 2px solid #444;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      color: white;
      font-family: Arial, sans-serif;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <div id="controls">
    <p>Player 1 (Blue): A/D (Move), W (Jump), F (Punch), G (Kick)</p>
    <p>Player 2 (Red): Arrow Left/Right (Move), Up (Jump), L (Punch), ; (Kick)</p>
    <p>Press punch/kick rapidly for combos!</p>
  </div>
  <script>
    let player1, player2;
    let ground;
    let player1Health = 100, player2Health = 100;
    let player1Combo = 0, player2Combo = 0;
    let lastHitTime1 = 0, lastHitTime2 = 0;
    let gameState = 'playing';

    function setup() {
      createCanvas(800, 600);

      // Create ground
      ground = createSprite(width / 2, height - 50, width, 100);
      ground.shapeColor = color(100, 100, 100);
      ground.immovable = true;

      // Player 1 (blue rectangle, left side, facing right)
      player1 = createSprite(200, height - 150, 50, 100);
      player1.shapeColor = color(0, 0, 255);
      player1.setCollider('rectangle', 0, 0, 50, 100);
      player1.mass = 1;
      player1.friction = 0.1;

      // Player 2 (red rectangle, right side, facing left)
      player2 = createSprite(600, height - 150, 50, 100);
      player2.shapeColor = color(255, 0, 0);
      player2.setCollider('rectangle', 0, 0, 50, 100);
      player2.mirrorX(-1);
      player2.mass = 1;
      player2.friction = 0.1;
    }

    function draw() {
      background(50);

      // Draw health bars
      fill(255, 0, 0);
      rect(50, 20, player1Health * 2, 20);
      rect(width - 250, 20, player2Health * 2, 20);
      fill(255);
      textSize(16);
      textAlign(LEFT);
      text('Player 1: ' + player1Health + '%', 50, 60);
      text('Player 2: ' + player2Health + '%', width - 250, 60);

      // Game over condition
      if (player1Health <= 0 || player2Health <= 0) {
        gameState = 'over';
        fill(255);
        textSize(32);
        textAlign(CENTER);
        text(player1Health <= 0 ? 'Player 2 Wins!' : 'Player 1 Wins!', width / 2, height / 2);
        noLoop();
        return;
      }

      // Player 1 controls
      if (keyIsDown(65)) { // A - Move left
        player1.position.x -= 5;
        player1.mirrorX(-1);
      }
      if (keyIsDown(68)) { // D - Move right
        player1.position.x += 5;
        player1.mirrorX(1);
      }
      if (keyIsDown(87) && abs(player1.position.y - (height - 150)) < 5) { // W - Jump
        player1.velocity.y = -12;
      }

      // Player 2 controls
      if (keyIsDown(LEFT_ARROW)) { // Left - Move left
        player2.position.x -= 5;
        player2.mirrorX(-1);
      }
      if (keyIsDown(RIGHT_ARROW)) { // Right - Move right
        player2.position.x += 5;
        player2.mirrorX(1);
      }
      if (keyIsDown(UP_ARROW) && abs(player2.position.y - (height - 150)) < 5) { // Up - Jump
        player2.velocity.y = -12;
      }

      // Handle attacks
      if (keyWentDown(70)) { // F - Player 1 Punch
        performAttack(player1, player2, 'punch');
      }
      if (keyWentDown(71)) { // G - Player 1 Kick
        performAttack(player1, player2, 'kick');
      }
      if (keyWentDown(76)) { // L - Player 2 Punch
        performAttack(player2, player1, 'punch');
      }
      if (keyWentDown(186)) { // ; - Player 2 Kick
        performAttack(player2, player1, 'kick');
      }

      // Apply gravity
      player1.velocity.y += 0.5;
      player2.velocity.y += 0.5;

      // Collide with ground
      player1.collide(ground);
      player2.collide(ground);

      // Keep players within bounds
      player1.position.x = constrain(player1.position.x, 25, width - 25);
      player2.position.x = constrain(player2.position.x, 25, width - 25);

      // Draw sprites
      drawSprites();

      // Reset combos after 1-second delay
      if (millis() - lastHitTime1 > 1000) player1Combo = 0;
      if (millis() - lastHitTime2 > 1000) player2Combo = 0;
    }

    function performAttack(attacker, defender, type) {
      let damage = type === 'punch' ? 5 : 8;
      let comboMultiplier = attacker === player1 ? player1Combo : player2Combo;
      damage *= (1 + comboMultiplier * 0.2); // Smaller combo multiplier for balance

      // Create temporary attack hitbox
      let hitbox = createSprite(
        attacker.position.x + (attacker.mirrorX() > 0 ? 40 : -40),
        attacker.position.y - 25,
        40,
        60
      );
      hitbox.shapeColor = color(255, 255, 0, 100); // Visible for debugging
      hitbox.life = 10; // Remove after ~10 frames

      if (hitbox.overlap(defender)) {
        if (attacker === player1) {
          player2Health = max(0, player2Health - damage);
          player1Combo++;
          lastHitTime1 = millis();
          // Knockback
          defender.position.x += attacker.mirrorX() * 15;
        } else {
          player1Health = max(0, player1Health - damage);
          player2Combo++;
          lastHitTime2 = millis();
          // Knockback
          defender.position.x += attacker.mirrorX() * 15;
        }
      }
    }
  </script>
</body>
</html>
